CREATE TABLE DEPARTMENT(DNO VARCHAR(20) PRIMARY KEY,DNAME
VARCHAR(20),MGRSTARTDATE DATE);

CREATE TABLE EMPLOYEE (SSN VARCHAR(20) PRIMARY KEY,FNAME VARCHAR(20),
LNAME VARCHAR(20),ADDRESS VARCHAR(20),SEX CHAR(1),SALARY INTEGER,
SUPERSSN VARCHAR(20),DNO VARCHAR(20),
foreign key(SUPERSSN) REFERENCES EMPLOYEE(SSN),
foreign key(DNO) REFERENCES DEPARTMENT (DNO));

ALTER TABLE DEPARTMENT ADD MGRSSN REFERENCES EMPLOYEE(SSN);

CREATE TABLE DLOCATION (DLOC VARCHAR(20),DNO VARCHAR(20),
foreign key(DNO) REFERENCES DEPARTMENT(DNO),
PRIMARY KEY (DNO, DLOC));

CREATE TABLE PROJECT (PNO INTEGER PRIMARY KEY,PNAME
VARCHAR(20), PLOCATION VARCHAR(20),DNO VARCHAR(20),
foreign key(DNO) REFERENCES DEPARTMENT(DNO));

CREATE TABLE WORKS_ON (SSN VARCHAR(20),PNO INTEGER,HOURS INTEGER,
foreign key(SSN) REFERENCES EMPLOYEE(SSN),
foreign key(PNO) REFERENCES PROJECT(PNO),
PRIMARY KEY (SSN, PNO));

             
INSERT INTO EMPLOYEE(SSN,FNAME,LNAME,ADDRESS,SEX,SALARY) VALUES('ACC01','AHANA','K','MANGALORE','F',350000);
INSERT INTO EMPLOYEE(SSN,FNAME,LNAME,ADDRESS,SEX,SALARY) VALUES('ACC02','SANTOSH','KUMAR','MANGALORE','M',300000);
             
INSERT INTO EMPLOYEE(SSN,FNAME,LNAME,ADDRESS,SEX,SALARY) VALUES('IT01','NAGESH','HR','BANGALORE','M',500000);
             
                      
INSERT INTO EMPLOYEE(SSN,FNAME,LNAME,ADDRESS,SEX,SALARY) VALUES('ECE01','JOHN','SCOTT','BANGALORE','M',450000);
             
INSERT INTO EMPLOYEE(SSN,FNAME,LNAME,ADDRESS,SEX,SALARY) VALUES('ISE01','VEENA','M','MYSORE','M',600000);
   
             
INSERT INTO EMPLOYEE(SSN,FNAME,LNAME,ADDRESS,SEX,SALARY) VALUES('CSE01','JAMES','SMITH','BANGALORE','M',500000);
INSERT INTO EMPLOYEE(SSN,FNAME,LNAME,ADDRESS,SEX,SALARY) VALUES('CSE02','HEARN','BAKER','BANGALORE','M',700000);
INSERT INTO EMPLOYEE(SSN,FNAME,LNAME,ADDRESS,SEX,SALARY) VALUES('CSE03','EDWARD','SCOTT','MYSORE','M',500000);
INSERT INTO EMPLOYEE(SSN,FNAME,LNAME,ADDRESS,SEX,SALARY) VALUES('CSE04','PAWAN','HEGDE','MANGALORE','M',650000);
INSERT INTO EMPLOYEE(SSN,FNAME,LNAME,ADDRESS,SEX,SALARY) VALUES('CSE05','GIRISH','MALAYA','MYSORE','M',450000);
INSERT INTO EMPLOYEE(SSN,FNAME,LNAME,ADDRESS,SEX,SALARY) VALUES('CSE06','NEHA','SN','BANGALORE','F',800000);
             
             
             
INSERT INTO DEPARTMENT VALUES('1','ACCOUNTS','01-Jan-21','ACC02');
INSERT INTO DEPARTMENT VALUES('2','IT','16-Aug-21','IT01');
INSERT INTO DEPARTMENT VALUES('3','ECE','08-Jun-21','ECE01');
INSERT INTO DEPARTMENT VALUES('4','ISE','15-Aug-21','ISE01');
INSERT INTO DEPARTMENT VALUES('5','CSE','02-Jun-21','CSE05');
             

             

UPDATE EMPLOYEE SET
SUPERSSN='ACC02',DNO='1'
WHERE SSN='ACC01';
             
UPDATE EMPLOYEE SET
SUPERSSN=NULL,DNO='1'
WHERE SSN='ACC01';
             
UPDATE EMPLOYEE SET
SUPERSSN=NULL,DNO='2'
WHERE SSN='IT01';
             
UPDATE EMPLOYEE SET
SUPERSSN=NULL,DNO='3'
WHERE SSN='ECE01';
             
UPDATE EMPLOYEE SET
SUPERSSN=NULL,DNO='4'
WHERE SSN='ISE01';

UPDATE EMPLOYEE SET
SUPERSSN='CSE02',DNO='5'
WHERE SSN='CSE01';

UPDATE EMPLOYEE SET
SUPERSSN='CSE03',DNO='5'
WHERE SSN='CSE02';

UPDATE EMPLOYEE SET
SUPERSSN='CSE04',DNO='5'
WHERE SSN='CSE03';
             
UPDATE EMPLOYEE SET
SUPERSSN='CSE05',DNO='5'
WHERE SSN='CSE04';
             
             
UPDATE EMPLOYEE SET
SUPERSSN=NULL,DNO='5'
WHERE SSN='CSE05';

UPDATE EMPLOYEE SET
SUPERSSN=NULL,DNO='5'
WHERE SSN='CSE06';
             
INSERT INTO DLOCATION VALUES ('BANGALORE','1'); 
INSERT INTO DLOCATION VALUES ('BANGALORE','2'); 
INSERT INTO DLOCATION VALUES ('BANGALORE','3'); 
INSERT INTO DLOCATION VALUES ('BANGALORE','4'); 
INSERT INTO DLOCATION VALUES ('BANGALORE','5'); 
             
INSERT INTO PROJECT VALUES (100,'BANK MANAGEMENT','BANGALORE','1');
INSERT INTO PROJECT VALUES (101,'SALARY MANAGEMENT','BANGALORE','1');
INSERT INTO PROJECT VALUES (102,'SMART CITY','BANGALORE','2');
INSERT INTO PROJECT VALUES (103,'SENSORS','BANGALORE','3');
INSERT INTO PROJECT VALUES (104,'OPENSTACK','BANGALORE','4');
INSERT INTO PROJECT VALUES (105,'BIGDATA','BANGALORE','5');
INSERT INTO PROJECT VALUES (106,'CLOUD','BANGALORE','5');
INSERT INTO PROJECT VALUES (107,'IOT','BANGALORE','5');


INSERT INTO WORKS_ON VALUES ('ACC01', 100,5);
INSERT INTO WORKS_ON VALUES ('ACC02', 101,6);
             
INSERT INTO WORKS_ON VALUES ('IT01', 102,10);
             
INSERT INTO WORKS_ON VALUES ('ECE01', 103,7);
         
INSERT INTO WORKS_ON VALUES ('ISE01', 104,4);
             
INSERT INTO WORKS_ON VALUES ('CSE01',105,4);
INSERT INTO WORKS_ON VALUES ('CSE01', 106,6);
INSERT INTO WORKS_ON VALUES ('CSE01', 107,8);
             
INSERT INTO WORKS_ON VALUES ('CSE02', 105,10);
INSERT INTO WORKS_ON VALUES ('CSE03', 107,6);

INSERT INTO WORKS_ON VALUES ('CSE04', 105,3);
INSERT INTO WORKS_ON VALUES ('CSE05', 106,4);
INSERT INTO WORKS_ON VALUES ('CSE06', 107,5);

 /* display project no where scott works as a manager and worker   */          
SELECT p.PNO
from project p, employee e, department d
where e.lname='SCOTT' 
and d.mgrssn=e.ssn 
and d.dno=p.dno
union
Select p.pno
from project p,employee e,works_on w
where e.lname='SCOTT'
and e.ssn=w.ssn
and p.pno=w.pno;


output:
PNO
103
107
             
             
/*b. Show the resulting salaries if every employee working on the ‘IoT’ project is given a 10 percent raise.*/
select e.fname,e.lname,1.1*e.salary as incr
from employee e,project p,works_on w
where p.pname='IOT'
and p.pno=w.pno 
and w.ssn=e.ssn


output:
FNAME	     LNAME	incr
JAMES	     SMITH	550000
EDWARD	   SCOTT	550000
NEHA	     SN	    880000            

/* Find the sum of the salaries of all employees of the ‘Accounts’ department, 
 as well as the maximum salary, the minimum salary, and the average salary in this department
*/             
             
select sum(e.salary),min(e.salary),max(e.salary),avg(e.salary)
from employee e,department d
where d.dname='ACCOUNTS'
and d.dno=e.dno;


output:
SUM(E.SALARY)	   MIN(E.SALARY)     	MAX(E.SALARY)   	AVG(E.SALARY)
350000	         350000	            350000	          350000             

             
/* Retrieve the name of each employee who works on all the projects Controlled by department number 5 (use NOT EXISTS operator).*/ 
 select e.fname,e.lname
from employee e
where not exists(
(select pno
from project 
where dno=5)
minus
(select pno
from works_on w
where w.ssn=e.ssn));
 
output:
 FNAME	LNAME
JAMES	SMITH

 
/*For each department that has more than five employees, retrieve the department number and the number of its employees who are making more than Rs. 6, 00,000.
 */
select d.dno,count(*)
from department d,employee e
where d.dno=e.dno
and e.salary>600000
and e.dno in (select dno
from employee 
group by dno
having count(*)>5)
group by e.dno;
 
 output:
 
 DNO	COUNT(*)
 5	    3
 
